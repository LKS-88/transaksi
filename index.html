<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Jadwal Shift & Penggajian Karyawan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --shift-pagi: #f1c40f;
            --shift-sore: #e67e22;
            --shift-malam: #34495e;
            --libur-color: #e74c3c;
            --cuti-color: #9b59b6;
            --sakit-color: #3498db;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background-color: var(--dark-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            background-color: var(--light-color);
            border-bottom: 1px solid #ddd;
        }

        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--dark-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-btn:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }

        .tab-btn.active {
            background-color: white;
            color: var(--primary-color);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--dark-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn-warning:hover {
            background-color: #d35400;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
        }

        tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .badge-pagi {
            background-color: var(--shift-pagi);
        }

        .badge-sore {
            background-color: var(--shift-sore);
        }

        .badge-malam {
            background-color: var(--shift-malam);
            color: white;
        }

        .badge-libur {
            background-color: var(--libur-color);
        }

        .badge-cuti {
            background-color: var(--cuti-color);
        }

        .badge-sakit {
            background-color: var(--sakit-color);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .calendar-header {
            font-weight: 600;
            text-align: center;
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 5px;
        }

        .calendar-day {
            border: 1px solid #eee;
            padding: 10px;
            min-height: 120px;
            background: white;
            border-radius: 5px;
            position: relative;
        }

        .calendar-day:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .shift-item {
            margin: 3px 0;
            padding: 5px;
            border-radius: 3px;
            font-size: 12px;
            background-color: rgba(52, 152, 219, 0.1);
        }

        .shift-pagi {
            background-color: rgba(241, 196, 15, 0.2);
            border-left: 3px solid var(--shift-pagi);
        }

        .shift-sore {
            background-color: rgba(230, 126, 34, 0.2);
            border-left: 3px solid var(--shift-sore);
        }

        .shift-malam {
            background-color: rgba(52, 73, 94, 0.2);
            border-left: 3px solid var(--shift-malam);
            color: var(--dark-color);
        }

        .special-note {
            font-size: 11px;
            padding: 3px 5px;
            border-radius: 3px;
            margin-top: 3px;
            display: inline-block;
        }

        .note-libur {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--libur-color);
        }

        .note-cuti {
            background-color: rgba(155, 89, 182, 0.2);
            color: var(--cuti-color);
        }

        .note-sakit {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--sakit-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }

        .close-btn:hover {
            color: var(--danger-color);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-active {
            background-color: var(--success-color);
        }

        .status-inactive {
            background-color: var(--danger-color);
        }

        .rupiah {
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            padding: 5px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background-color: var(--warning-color);
            color: white;
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .view-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .search-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
        }

        .filter-select {
            width: 200px;
        }

        @media (max-width: 768px) {
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }
            
            .search-filter {
                flex-direction: column;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .row {
                flex-direction: column;
            }
            
            .calendar-day {
                min-height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-calendar-alt"></i> Sistem Jadwal Shift & Penggajian Karyawan</h1>
            <p>Manajemen jadwal kerja shift dan perhitungan gaji otomatis</p>
        </header>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
                <button class="tab-btn" data-tab="karyawan"><i class="fas fa-users"></i> Data Karyawan</button>
                <button class="tab-btn" data-tab="jadwal"><i class="fas fa-calendar"></i> Jadwal Shift</button>
                <button class="tab-btn" data-tab="absensi"><i class="fas fa-fingerprint"></i> Absensi</button>
                <button class="tab-btn" data-tab="penggajian"><i class="fas fa-calculator"></i> Penggajian</button>
                <button class="tab-btn" data-tab="laporan"><i class="fas fa-file-pdf"></i> Laporan</button>
            </div>
            
            <!-- Tab Dashboard -->
            <div id="dashboard" class="tab-content active">
                <div class="card">
                    <h2 class="card-title">Ringkasan</h2>
                    <div class="row" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="col" style="flex: 1; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h3><i class="fas fa-users"></i> Total Karyawan</h3>
                            <p style="font-size: 24px; font-weight: bold;" id="total-karyawan">0</p>
                        </div>
                        <div class="col" style="flex: 1; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h3><i class="fas fa-calendar-check"></i> Shift Hari Ini</h3>
                            <p style="font-size: 24px; font-weight: bold;" id="shift-hari-ini">0</p>
                        </div>
                        <div class="col" style="flex: 1; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h3><i class="fas fa-user-clock"></i> Belum Absen</h3>
                            <p style="font-size: 24px; font-weight: bold;" id="belum-absen">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Kalender Bulan Ini</h2>
                    <div id="mini-calendar"></div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Aktivitas Terkini</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Karyawan</th>
                                <th>Aktivitas</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="aktivitas-terkini">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tab Data Karyawan -->
            <div id="karyawan" class="tab-content">
                <div class="card">
                    <h2 class="card-title">Manajemen Data Karyawan</h2>
                    <div class="search-filter">
                        <input type="text" id="search-karyawan" class="form-control search-input" placeholder="Cari karyawan...">
                        <select id="filter-status" class="form-control filter-select">
                            <option value="">Semua Status</option>
                            <option value="active">Aktif</option>
                            <option value="inactive">Non-Aktif</option>
                        </select>
                        <button class="btn btn-success" id="tambah-karyawan-btn"><i class="fas fa-plus"></i> Tambah</button>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nama</th>
                                    <th>Posisi</th>
                                    <th>Status</th>
                                    <th>Tanggal Bergabung</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-karyawan">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Tab Jadwal Shift -->
            <div id="jadwal" class="tab-content">
                <div class="card">
                    <h2 class="card-title">Pembuatan Jadwal Shift</h2>
                    <div class="form-group">
                        <label for="bulan-jadwal">Pilih Bulan dan Tahun:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="month" id="bulan-jadwal" class="form-control" style="flex: 1;">
                            <button class="btn" id="generate-jadwal-btn"><i class="fas fa-sync-alt"></i> Generate</button>
                            <button class="btn btn-success" id="simpan-jadwal-btn"><i class="fas fa-save"></i> Simpan</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Pola Rotasi Shift:</label>
                        <select id="pola-rotasi" class="form-control">
                            <option value="3-2-2">3-2-2 (3 pagi, 2 sore, 2 malam, 2 libur)</option>
                            <option value="4-3-3">4-3-3 (4 pagi, 3 sore, 3 malam, 2 libur)</option>
                            <option value="2-2-3">2-2-3 (2 pagi, 2 sore, 3 malam, 2 libur)</option>
                        </select>
                    </div>
                    
                    <div id="calendar-container" style="margin-top: 20px;">
                        <!-- Kalender akan diisi oleh JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Tab Absensi -->
            <div id="absensi" class="tab-content">
                <div class="card">
                    <h2 class="card-title">Sistem Absensi</h2>
                    <div class="form-group">
                        <label for="tanggal-absensi">Pilih Tanggal:</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="date" id="tanggal-absensi" class="form-control" style="flex: 1;">
                            <button class="btn" id="load-absensi-btn"><i class="fas fa-search"></i> Tampilkan</button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Karyawan</th>
                                    <th>Shift</th>
                                    <th>Jadwal</th>
                                    <th>Absen Masuk</th>
                                    <th>Absen Pulang</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-absensi">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">Rekap Absensi Bulan Ini</h2>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Karyawan</th>
                                    <th>Total Hadir</th>
                                    <th>Total Terlambat</th>
                                    <th>Total Absen</th>
                                    <th>Persentase</th>
                                </tr>
                            </thead>
                            <tbody id="rekap-absensi">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Tab Penggajian -->
            <div id="penggajian" class="tab-content">
                <div class="card">
                    <h2 class="card-title">Perhitungan Gaji Karyawan</h2>
                    <div class="form-group">
                        <label for="bulan-gaji">Pilih Bulan dan Tahun:</label>
                        <input type="month" id="bulan-gaji" class="form-control">
                    </div>
                    
                    <div class="row" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group" style="flex: 1;">
                            <label for="gaji-pokok">Gaji Pokok per Hari (Rp):</label>
                            <input type="number" id="gaji-pokok" class="form-control" value="150000">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="uang-transport">Uang Transport (Rp):</label>
                            <input type="number" id="uang-transport" class="form-control" value="20000">
                        </div>
                    </div>
                    
                    <div class="row" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group" style="flex: 1;">
                            <label for="bonus-harian">Bonus Harian (Rp):</label>
                            <input type="number" id="bonus-harian" class="form-control" value="0">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="bonus-mingguan">Bonus Mingguan (Rp):</label>
                            <input type="number" id="bonus-mingguan" class="form-control" value="0">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="bonus-bulanan">Bonus Bulanan (Rp):</label>
                            <input type="number" id="bonus-bulanan" class="form-control" value="0">
                        </div>
                    </div>
                    
                    <button class="btn" id="hitung-gaji-btn"><i class="fas fa-calculator"></i> Hitung Gaji</button>
                    
                    <div class="table-responsive" style="margin-top: 20px;">
                        <table id="tabel-gaji">
                            <thead>
                                <tr>
                                    <th>Nama Karyawan</th>
                                    <th>Total Shift</th>
                                    <th>Gaji Pokok</th>
                                    <th>Transport</th>
                                    <th>Bonus</th>
                                    <th>Potongan</th>
                                    <th>Total Gaji</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Tab Laporan -->
            <div id="laporan" class="tab-content">
                <div class="card">
                    <h2 class="card-title">Generasi Laporan</h2>
                    <div class="form-group">
                        <label for="jenis-laporan">Jenis Laporan:</label>
                        <select id="jenis-laporan" class="form-control">
                            <option value="jadwal">Jadwal Shift</option>
                            <option value="absensi">Rekap Absensi</option>
                            <option value="penggajian">Laporan Penggajian</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bulan-laporan">Pilih Periode:</label>
                        <input type="month" id="bulan-laporan" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="format-laporan">Format Laporan:</label>
                        <select id="format-laporan" class="form-control">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="cetak">Cetak Langsung</option>
                        </select>
                    </div>
                    
                    <button class="btn" id="generate-laporan-btn"><i class="fas fa-file-export"></i> Generate Laporan</button>
                    <button class="btn btn-success" id="cetak-laporan-btn"><i class="fas fa-print"></i> Cetak</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah/Edit Karyawan -->
    <div id="karyawanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalKaryawanTitle">Tambah Karyawan Baru</h3>
                <button class="close-btn" data-modal="karyawanModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modal-nama">Nama Lengkap:</label>
                    <input type="text" id="modal-nama" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-posisi">Posisi/Jabatan:</label>
                    <input type="text" id="modal-posisi" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-departemen">Departemen:</label>
                    <input type="text" id="modal-departemen" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-tanggal-bergabung">Tanggal Bergabung:</label>
                    <input type="date" id="modal-tanggal-bergabung" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-status">Status:</label>
                    <select id="modal-status" class="form-control">
                        <option value="active">Aktif</option>
                        <option value="inactive">Non-Aktif</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-gaji-pokok">Gaji Pokok per Hari (Rp):</label>
                    <input type="number" id="modal-gaji-pokok" class="form-control" value="150000">
                </div>
                <div class="form-group">
                    <label for="modal-no-hp">Nomor HP:</label>
                    <input type="text" id="modal-no-hp" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-email">Email:</label>
                    <input type="email" id="modal-email" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-alamat">Alamat:</label>
                    <textarea id="modal-alamat" class="form-control" rows="3"></textarea>
                </div>
                <input type="hidden" id="modal-karyawan-id">
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button class="btn btn-danger" data-modal="karyawanModal">Batal</button>
                <button class="btn btn-success" id="simpan-karyawan-btn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal Detail Jadwal -->
    <div id="jadwalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalJadwalTitle">Detail Jadwal</h3>
                <button class="close-btn" data-modal="jadwalModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Tanggal:</label>
                    <p id="modal-jadwal-tanggal"></p>
                </div>
                <div class="form-group">
                    <label for="modal-jadwal-shift">Shift:</label>
                    <select id="modal-jadwal-shift" class="form-control">
                        <option value="pagi">Pagi (07:00 - 15:00)</option>
                        <option value="sore">Sore (15:00 - 23:00)</option>
                        <option value="malam">Malam (23:00 - 07:00)</option>
                        <option value="libur">Libur</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-jadwal-karyawan">Karyawan:</label>
                    <select id="modal-jadwal-karyawan" class="form-control">
                        <!-- Opsi karyawan akan diisi oleh JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-jadwal-keterangan">Keterangan:</label>
                    <input type="text" id="modal-jadwal-keterangan" class="form-control" placeholder="Misal: Cuti, Sakit, dll.">
                </div>
                <input type="hidden" id="modal-jadwal-id">
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button class="btn btn-danger" data-modal="jadwalModal">Batal</button>
                <button class="btn btn-success" id="simpan-detail-jadwal-btn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal Absensi -->
    <div id="absensiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalAbsensiTitle">Rekam Absensi</h3>
                <button class="close-btn" data-modal="absensiModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Karyawan:</label>
                    <p id="modal-absensi-nama"></p>
                </div>
                <div class="form-group">
                    <label>Shift:</label>
                    <p id="modal-absensi-shift"></p>
                </div>
                <div class="form-group">
                    <label>Tanggal:</label>
                    <p id="modal-absensi-tanggal"></p>
                </div>
                <div class="form-group">
                    <label for="modal-absensi-masuk">Jam Masuk:</label>
                    <input type="time" id="modal-absensi-masuk" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-absensi-pulang">Jam Pulang:</label>
                    <input type="time" id="modal-absensi-pulang" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-absensi-status">Status:</label>
                    <select id="modal-absensi-status" class="form-control">
                        <option value="hadir">Hadir</option>
                        <option value="terlambat">Terlambat</option>
                        <option value="izin">Izin</option>
                        <option value="sakit">Sakit</option>
                        <option value="cuti">Cuti</option>
                        <option value="alpa">Tanpa Keterangan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-absensi-keterangan">Keterangan:</label>
                    <textarea id="modal-absensi-keterangan" class="form-control" rows="3"></textarea>
                </div>
                <input type="hidden" id="modal-absensi-id">
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button class="btn btn-danger" data-modal="absensiModal">Batal</button>
                <button class="btn btn-success" id="simpan-absensi-btn">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let karyawan = [
            { id: 1, nama: "Budi Santoso", posisi: "Staff Operasional", departemen: "Produksi", tanggalBergabung: "2022-01-15", status: "active", gajiPokok: 150000, noHp: "08123456789", email: "budi@example.com", alamat: "Jl. Merdeka No. 123" },
            { id: 2, nama: "Ani Wijaya", posisi: "Supervisor", departemen: "Produksi", tanggalBergabung: "2021-05-10", status: "active", gajiPokok: 200000, noHp: "08234567890", email: "ani@example.com", alamat: "Jl. Sudirman No. 45" },
            { id: 3, nama: "Cahyo Pratama", posisi: "Operator", departemen: "Produksi", tanggalBergabung: "2023-02-20", status: "active", gajiPokok: 130000, noHp: "08345678901", email: "cahyo@example.com", alamat: "Jl. Gatot Subroto No. 67" }
        ];
        
        let jadwal = {};
        let absensi = {};
        let penggajian = {};
        
        // Inisialisasi data contoh
        function initSampleData() {
            const today = new Date();
            const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            
            // Contoh jadwal
            if (!jadwal[currentMonth]) {
                jadwal[currentMonth] = {};
                
                const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = currentMonth + '-' + String(day).padStart(2, '0');
                    const dayOfWeek = new Date(today.getFullYear(), today.getMonth(), day).getDay();
                    
                    // Skip weekend (Sabtu dan Minggu) sebagai contoh libur
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        jadwal[currentMonth][dateStr] = [
                            { karyawanId: 1, shift: 'libur', keterangan: 'Libur akhir pekan' },
                            { karyawanId: 2, shift: 'libur', keterangan: 'Libur akhir pekan' },
                            { karyawanId: 3, shift: 'libur', keterangan: 'Libur akhir pekan' }
                        ];
                    } else {
                        // Rotasi shift sederhana
                        const shift1 = day % 3 === 0 ? 'pagi' : (day % 3 === 1 ? 'sore' : 'malam');
                        const shift2 = day % 3 === 1 ? 'pagi' : (day % 3 === 2 ? 'sore' : 'malam');
                        const shift3 = day % 3 === 2 ? 'pagi' : (day % 3 === 0 ? 'sore' : 'malam');
                        
                        jadwal[currentMonth][dateStr] = [
                            { karyawanId: 1, shift: shift1, keterangan: '' },
                            { karyawanId: 2, shift: shift2, keterangan: '' },
                            { karyawanId: 3, shift: shift3, keterangan: '' }
                        ];
                    }
                }
            }
            
            // Contoh absensi
            if (!absensi[currentMonth]) {
                absensi[currentMonth] = {};
                
                const todayStr = currentMonth + '-' + String(today.getDate()).padStart(2, '0');
                absensi[currentMonth][todayStr] = [
                    { 
                        karyawanId: 1, 
                        shift: jadwal[currentMonth][todayStr][0].shift, 
                        masuk: '07:05', 
                        pulang: '15:00', 
                        status: 'hadir', 
                        keterangan: '' 
                    },
                    { 
                        karyawanId: 2, 
                        shift: jadwal[currentMonth][todayStr][1].shift, 
                        masuk: '', 
                        pulang: '', 
                        status: 'sakit', 
                        keterangan: 'Surat dokter terlampir' 
                    },
                    { 
                        karyawanId: 3, 
                        shift: jadwal[currentMonth][todayStr][2].shift, 
                        masuk: '23:10', 
                        pulang: '07:00', 
                        status: 'terlambat', 
                        keterangan: 'Terlambat 10 menit' 
                    }
                ];
            }
            
            updateDashboard();
            updateTabelKaryawan();
        }
        
        // Tab functionality
        function setupTabNavigation() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and buttons
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab and button
                    document.getElementById(tabName).classList.add('active');
                    this.classList.add('active');
                    
                    // Load specific tab data if needed
                    if (tabName === 'absensi') {
                        const today = new Date();
                        document.getElementById('tanggal-absensi').value = today.toISOString().split('T')[0];
                        loadAbsensi();
                    } else if (tabName === 'jadwal') {
                        const today = new Date();
                        const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
                        document.getElementById('bulan-jadwal').value = currentMonth;
                        generateJadwal();
                    } else if (tabName === 'penggajian') {
                        const today = new Date();
                        const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
                        document.getElementById('bulan-gaji').value = currentMonth;
                        hitungGaji();
                    }
                });
            });
        }
        
        // Modal functions
        function setupModalFunctionality() {
            // Open modal buttons
            document.getElementById('tambah-karyawan-btn').addEventListener('click', tambahKaryawanModal);
            
            // Close modal buttons
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    closeModal(modalId);
                });
            });
            
            // Modal cancel buttons
            document.querySelectorAll('[data-modal]').forEach(btn => {
                if (btn.classList.contains('btn-danger')) {
                    btn.addEventListener('click', function() {
                        const modalId = this.getAttribute('data-modal');
                        closeModal(modalId);
                    });
                }
            });
            
            // Save buttons
            document.getElementById('simpan-karyawan-btn').addEventListener('click', simpanKaryawan);
            document.getElementById('simpan-detail-jadwal-btn').addEventListener('click', simpanDetailJadwal);
            document.getElementById('simpan-absensi-btn').addEventListener('click', simpanAbsensi);
            
            // Other buttons
            document.getElementById('generate-jadwal-btn').addEventListener('click', generateJadwal);
            document.getElementById('simpan-jadwal-btn').addEventListener('click', simpanJadwal);
            document.getElementById('load-absensi-btn').addEventListener('click', loadAbsensi);
            document.getElementById('hitung-gaji-btn').addEventListener('click', hitungGaji);
            document.getElementById('generate-laporan-btn').addEventListener('click', generateLaporan);
            document.getElementById('cetak-laporan-btn').addEventListener('click', cetakLaporan);
            
            // Search and filter
            document.getElementById('search-karyawan').addEventListener('input', updateTabelKaryawan);
            document.getElementById('filter-status').addEventListener('change', updateTabelKaryawan);
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Karyawan functions
        function tambahKaryawanModal() {
            document.getElementById('modalKaryawanTitle').textContent = 'Tambah Karyawan Baru';
            document.getElementById('modal-nama').value = '';
            document.getElementById('modal-posisi').value = '';
            document.getElementById('modal-departemen').value = '';
            document.getElementById('modal-tanggal-bergabung').value = '';
            document.getElementById('modal-status').value = 'active';
            document.getElementById('modal-gaji-pokok').value = '150000';
            document.getElementById('modal-no-hp').value = '';
            document.getElementById('modal-email').value = '';
            document.getElementById('modal-alamat').value = '';
            document.getElementById('modal-karyawan-id').value = '';
            
            openModal('karyawanModal');
        }
        
        function editKaryawanModal(id) {
            const karyawanEdit = karyawan.find(k => k.id === id);
            if (karyawanEdit) {
                document.getElementById('modalKaryawanTitle').textContent = 'Edit Data Karyawan';
                document.getElementById('modal-nama').value = karyawanEdit.nama;
                document.getElementById('modal-posisi').value = karyawanEdit.posisi;
                document.getElementById('modal-departemen').value = karyawanEdit.departemen || '';
                document.getElementById('modal-tanggal-bergabung').value = karyawanEdit.tanggalBergabung;
                document.getElementById('modal-status').value = karyawanEdit.status || 'active';
                document.getElementById('modal-gaji-pokok').value = karyawanEdit.gajiPokok || '150000';
                document.getElementById('modal-no-hp').value = karyawanEdit.noHp || '';
                document.getElementById('modal-email').value = karyawanEdit.email || '';
                document.getElementById('modal-alamat').value = karyawanEdit.alamat || '';
                document.getElementById('modal-karyawan-id').value = karyawanEdit.id;
                
                openModal('karyawanModal');
            }
        }
        
        function simpanKaryawan() {
            const id = document.getElementById('modal-karyawan-id').value;
            const nama = document.getElementById('modal-nama').value;
            const posisi = document.getElementById('modal-posisi').value;
            const departemen = document.getElementById('modal-departemen').value;
            const tanggalBergabung = document.getElementById('modal-tanggal-bergabung').value;
            const status = document.getElementById('modal-status').value;
            const gajiPokok = parseInt(document.getElementById('modal-gaji-pokok').value) || 150000;
            const noHp = document.getElementById('modal-no-hp').value;
            const email = document.getElementById('modal-email').value;
            const alamat = document.getElementById('modal-alamat').value;
            
            if (!nama || !posisi || !tanggalBergabung) {
                alert('Harap isi nama, posisi, dan tanggal bergabung!');
                return;
            }
            
            if (id) {
                // Edit karyawan yang ada
                const index = karyawan.findIndex(k => k.id === parseInt(id));
                if (index !== -1) {
                    karyawan[index] = {
                        ...karyawan[index],
                        nama,
                        posisi,
                        departemen,
                        tanggalBergabung,
                        status,
                        gajiPokok,
                        noHp,
                        email,
                        alamat
                    };
                }
            } else {
                // Tambah karyawan baru
                const newId = karyawan.length > 0 ? Math.max(...karyawan.map(k => k.id)) + 1 : 1;
                karyawan.push({
                    id: newId,
                    nama,
                    posisi,
                    departemen,
                    tanggalBergabung,
                    status,
                    gajiPokok,
                    noHp,
                    email,
                    alamat
                });
            }
            
            updateTabelKaryawan();
            updateDashboard();
            closeModal('karyawanModal');
        }
        
        function hapusKaryawan(id) {
            if (confirm('Apakah Anda yakin ingin menghapus karyawan ini?')) {
                karyawan = karyawan.filter(k => k.id !== id);
                updateTabelKaryawan();
                updateDashboard();
            }
        }
        
        function updateTabelKaryawan() {
            const tbody = document.querySelector('#tabel-karyawan tbody');
            tbody.innerHTML = '';
            
            const searchTerm = document.getElementById('search-karyawan').value.toLowerCase();
            const statusFilter = document.getElementById('filter-status').value;
            
            const filteredKaryawan = karyawan.filter(k => {
                const matchesSearch = k.nama.toLowerCase().includes(searchTerm) || 
                                    k.posisi.toLowerCase().includes(searchTerm) ||
                                    (k.departemen && k.departemen.toLowerCase().includes(searchTerm));
                const matchesStatus = !statusFilter || k.status === statusFilter;
                return matchesSearch && matchesStatus;
            });
            
            filteredKaryawan.forEach(k => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${k.id}</td>
                    <td>${k.nama}</td>
                    <td>${k.posisi}</td>
                    <td>
                        <span class="status-indicator ${k.status === 'active' ? 'status-active' : 'status-inactive'}"></span>
                        ${k.status === 'active' ? 'Aktif' : 'Non-Aktif'}
                    </td>
                    <td>${formatTanggal(k.tanggalBergabung)}</td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editKaryawanModal(${k.id})"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete-btn" onclick="hapusKaryawan(${k.id})"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('total-karyawan').textContent = karyawan.filter(k => k.status === 'active').length;
        }
        
        // Jadwal functions
        function generateJadwal() {
            const bulanInput = document.getElementById('bulan-jadwal').value;
            if (!bulanInput) {
                alert('Pilih bulan terlebih dahulu!');
                return;
            }
            
            const [tahun, bulan] = bulanInput.split('-');
            const hariDalamBulan = new Date(tahun, bulan, 0).getDate();
            const tanggalPertama = new Date(tahun, bulan - 1, 1);
            const hariPertama = tanggalPertama.getDay(); // 0 = Minggu, 1 = Senin, dst.
            
            const polaRotasi = document.getElementById('pola-rotasi').value;
            let pola = [];
            
            // Tentukan pola rotasi berdasarkan pilihan
            if (polaRotasi === '3-2-2') {
                pola = ['pagi', 'pagi', 'pagi', 'sore', 'sore', 'malam', 'malam', 'libur', 'libur'];
            } else if (polaRotasi === '4-3-3') {
                pola = ['pagi', 'pagi', 'pagi', 'pagi', 'sore', 'sore', 'sore', 'malam', 'malam', 'malam', 'libur', 'libur'];
            } else if (polaRotasi === '2-2-3') {
                pola = ['pagi', 'pagi', 'sore', 'sore', 'malam', 'malam', 'malam', 'libur', 'libur'];
            }
            
            // Inisialisasi jadwal untuk bulan ini jika belum ada
            if (!jadwal[bulanInput]) {
                jadwal[bulanInput] = {};
            }
            
            const container = document.getElementById('calendar-container');
            container.innerHTML = '<h3>Jadwal Bulan ' + getNamaBulan(bulan - 1) + ' ' + tahun + '</h3>';
            
            const calendar = document.createElement('div');
            calendar.className = 'calendar';
            
            // Header hari
            const hariMinggu = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            hariMinggu.forEach(hari => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = hari;
                calendar.appendChild(header);
            });
            
            // Isi kalender
            for (let i = 0; i < hariPertama; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendar.appendChild(emptyDay);
            }
            
            const activeKaryawan = karyawan.filter(k => k.status === 'active');
            
            for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                const dateStr = bulanInput + '-' + String(tanggal).padStart(2, '0');
                const dayOfWeek = new Date(tahun, bulan - 1, tanggal).getDay();
                
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.innerHTML = `<div class="day-number">${tanggal}</div>`;
                
                // Generate jadwal secara otomatis
                if (!jadwal[bulanInput][dateStr]) {
                    jadwal[bulanInput][dateStr] = [];
                    
                    // Skip weekend (Sabtu dan Minggu) sebagai contoh libur
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        activeKaryawan.forEach(k => {
                            jadwal[bulanInput][dateStr].push({
                                karyawanId: k.id,
                                shift: 'libur',
                                keterangan: 'Libur akhir pekan'
                            });
                        });
                    } else {
                        // Terapkan pola rotasi
                        activeKaryawan.forEach((k, index) => {
                            const polaIndex = (tanggal + index) % pola.length;
                            const shift = pola[polaIndex];
                            
                            jadwal[bulanInput][dateStr].push({
                                karyawanId: k.id,
                                shift: shift,
                                keterangan: ''
                            });
                        });
                    }
                }
                
                // Tampilkan jadwal untuk hari ini
                jadwal[bulanInput][dateStr].forEach(item => {
                    const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                    if (!karyawanData) return;
                    
                    const shiftItem = document.createElement('div');
                    shiftItem.className = `shift-item shift-${item.shift}`;
                    shiftItem.innerHTML = `
                        <strong>${karyawanData.nama}</strong>
                        <span class="badge badge-${item.shift}">${item.shift.toUpperCase()}</span>
                        ${item.keterangan ? `<div class="special-note note-${item.keterangan.toLowerCase().includes('cuti') ? 'cuti' : item.keterangan.toLowerCase().includes('sakit') ? 'sakit' : 'libur'}">${item.keterangan}</div>` : ''}
                    `;
                    
                    // Tambahkan tombol edit
                    const editBtn = document.createElement('button');
                    editBtn.className = 'action-btn edit-btn';
                    editBtn.style.marginTop = '5px';
                    editBtn.style.width = '100%';
                    editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
                    editBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        editJadwalModal(dateStr, item.karyawanId);
                    });
                    
                    shiftItem.appendChild(editBtn);
                    day.appendChild(shiftItem);
                });
                
                calendar.appendChild(day);
            }
            
            container.appendChild(calendar);
        }
        
        function simpanJadwal() {
            const bulanInput = document.getElementById('bulan-jadwal').value;
            if (!bulanInput) {
                alert('Pilih bulan terlebih dahulu!');
                return;
            }
            
            alert('Jadwal berhasil disimpan!');
            // Dalam implementasi nyata, di sini akan ada pengiriman data ke server
        }
        
        function editJadwalModal(dateStr, karyawanId) {
            const bulanInput = document.getElementById('bulan-jadwal').value;
            if (!jadwal[bulanInput] || !jadwal[bulanInput][dateStr]) return;
            
            const jadwalItem = jadwal[bulanInput][dateStr].find(item => item.karyawanId === karyawanId);
            if (!jadwalItem) return;
            
            const karyawanData = karyawan.find(k => k.id === karyawanId);
            if (!karyawanData) return;
            
            document.getElementById('modalJadwalTitle').textContent = `Edit Jadwal ${karyawanData.nama}`;
            document.getElementById('modal-jadwal-tanggal').textContent = formatTanggal(dateStr);
            document.getElementById('modal-jadwal-shift').value = jadwalItem.shift;
            document.getElementById('modal-jadwal-keterangan').value = jadwalItem.keterangan;
            
            // Isi dropdown karyawan
            const selectKaryawan = document.getElementById('modal-jadwal-karyawan');
            selectKaryawan.innerHTML = '';
            karyawan.filter(k => k.status === 'active').forEach(k => {
                const option = document.createElement('option');
                option.value = k.id;
                option.textContent = k.nama;
                option.selected = k.id === karyawanId;
                selectKaryawan.appendChild(option);
            });
            
            document.getElementById('modal-jadwal-id').value = `${dateStr}-${karyawanId}`;
            openModal('jadwalModal');
        }
        
        function simpanDetailJadwal() {
            const modalId = document.getElementById('modal-jadwal-id').value;
            const [dateStr, karyawanId] = modalId.split('-');
            const bulanInput = document.getElementById('bulan-jadwal').value;
            
            const shift = document.getElementById('modal-jadwal-shift').value;
            const karyawanBaruId = parseInt(document.getElementById('modal-jadwal-karyawan').value);
            const keterangan = document.getElementById('modal-jadwal-keterangan').value;
            
            if (!jadwal[bulanInput] || !jadwal[bulanInput][dateStr]) return;
            
            // Hapus jadwal lama jika karyawan berubah
            if (karyawanBaruId !== parseInt(karyawanId)) {
                jadwal[bulanInput][dateStr] = jadwal[bulanInput][dateStr].filter(item => item.karyawanId !== parseInt(karyawanId));
            }
            
            // Cek apakah karyawan sudah ada di tanggal ini
            const existingIndex = jadwal[bulanInput][dateStr].findIndex(item => item.karyawanId === karyawanBaruId);
            
            if (existingIndex !== -1) {
                // Update jadwal yang ada
                jadwal[bulanInput][dateStr][existingIndex] = {
                    karyawanId: karyawanBaruId,
                    shift: shift,
                    keterangan: keterangan
                };
            } else {
                // Tambahkan jadwal baru
                jadwal[bulanInput][dateStr].push({
                    karyawanId: karyawanBaruId,
                    shift: shift,
                    keterangan: keterangan
                });
            }
            
            // Generate ulang tampilan jadwal
            generateJadwal();
            closeModal('jadwalModal');
        }
        
        // Absensi functions
        function loadAbsensi() {
            const tanggalInput = document.getElementById('tanggal-absensi').value;
            if (!tanggalInput) {
                alert('Pilih tanggal terlebih dahulu!');
                return;
            }
            
            const [tahun, bulan, tanggal] = tanggalInput.split('-');
            const bulanInput = `${tahun}-${bulan}`;
            const dateStr = `${tahun}-${bulan}-${tanggal}`;
            
            const tbody = document.querySelector('#tabel-absensi tbody');
            tbody.innerHTML = '';
            
            // Pastikan jadwal untuk tanggal ini ada
            if (!jadwal[bulanInput] || !jadwal[bulanInput][dateStr]) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada jadwal untuk tanggal ini</td></tr>';
                return;
            }
            
            // Inisialisasi absensi jika belum ada
            if (!absensi[bulanInput]) {
                absensi[bulanInput] = {};
            }
            if (!absensi[bulanInput][dateStr]) {
                absensi[bulanInput][dateStr] = [];
            }
            
            jadwal[bulanInput][dateStr].forEach(item => {
                const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                if (!karyawanData) return;
                
                const absensiItem = absensi[bulanInput][dateStr].find(a => a.karyawanId === item.karyawanId) || {
                    karyawanId: item.karyawanId,
                    shift: item.shift,
                    masuk: '',
                    pulang: '',
                    status: item.shift === 'libur' ? 'libur' : 'alpa',
                    keterangan: item.keterangan || ''
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${karyawanData.nama}</td>
                    <td><span class="badge badge-${item.shift}">${item.shift.toUpperCase()}</span></td>
                    <td>${getJamShift(item.shift)}</td>
                    <td>${absensiItem.masuk || '-'}</td>
                    <td>${absensiItem.pulang || '-'}</td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(absensiItem.status)}">${getStatusText(absensiItem.status)}</span>
                        ${absensiItem.keterangan ? `<small>${absensiItem.keterangan}</small>` : ''}
                    </td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editAbsensiModal('${dateStr}', ${item.karyawanId})"><i class="fas fa-edit"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updateRekapAbsensi(bulanInput);
        }
        
        function editAbsensiModal(dateStr, karyawanId) {
            const [tahun, bulan, tanggal] = dateStr.split('-');
            const bulanInput = `${tahun}-${bulan}`;
            
            const jadwalItem = jadwal[bulanInput][dateStr].find(item => item.karyawanId === karyawanId);
            if (!jadwalItem) return;
            
            const karyawanData = karyawan.find(k => k.id === karyawanId);
            if (!karyawanData) return;
            
            let absensiItem = absensi[bulanInput][dateStr]?.find(a => a.karyawanId === karyawanId);
            if (!absensiItem) {
                absensiItem = {
                    karyawanId,
                    shift: jadwalItem.shift,
                    masuk: '',
                    pulang: '',
                    status: jadwalItem.shift === 'libur' ? 'libur' : 'alpa',
                    keterangan: jadwalItem.keterangan || ''
                };
            }
            
            document.getElementById('modalAbsensiTitle').textContent = `Rekam Absensi ${karyawanData.nama}`;
            document.getElementById('modal-absensi-nama').textContent = karyawanData.nama;
            document.getElementById('modal-absensi-shift').textContent = `${jadwalItem.shift.toUpperCase()} (${getJamShift(jadwalItem.shift)})`;
            document.getElementById('modal-absensi-tanggal').textContent = formatTanggal(dateStr);
            document.getElementById('modal-absensi-masuk').value = absensiItem.masuk;
            document.getElementById('modal-absensi-pulang').value = absensiItem.pulang;
            document.getElementById('modal-absensi-status').value = absensiItem.status;
            document.getElementById('modal-absensi-keterangan').value = absensiItem.keterangan;
            document.getElementById('modal-absensi-id').value = `${dateStr}-${karyawanId}`;
            
            openModal('absensiModal');
        }
        
        function simpanAbsensi() {
            const modalId = document.getElementById('modal-absensi-id').value;
            const [dateStr, karyawanId] = modalId.split('-');
            const [tahun, bulan, tanggal] = dateStr.split('-');
            const bulanInput = `${tahun}-${bulan}`;
            
            const masuk = document.getElementById('modal-absensi-masuk').value;
            const pulang = document.getElementById('modal-absensi-pulang').value;
            const status = document.getElementById('modal-absensi-status').value;
            const keterangan = document.getElementById('modal-absensi-keterangan').value;
            
            // Validasi absensi sesuai jadwal shift
            const jadwalItem = jadwal[bulanInput][dateStr].find(item => item.karyawanId === parseInt(karyawanId));
            if (jadwalItem && jadwalItem.shift !== 'libur' && status !== 'libur' && status !== 'cuti' && status !== 'sakit' && status !== 'izin') {
                const shiftTime = getJamShift(jadwalItem.shift).split(' - ');
                const jamMasukShift = shiftTime[0];
                const jamPulangShift = shiftTime[1];
                
                if (masuk && jamMasukShift) {
                    const [masukHH, masukMM] = masuk.split(':').map(Number);
                    const [shiftHH, shiftMM] = jamMasukShift.split(':').map(Number);
                    
                    const masukDate = new Date(2000, 0, 1, masukHH, masukMM);
                    const shiftDate = new Date(2000, 0, 1, shiftHH, shiftMM);
                    
                    // Jika absen masuk lebih dari 1 jam setelah jam shift, tolak
                    if (masukDate - shiftDate > 60 * 60 * 1000) {
                        alert('Absen masuk tidak sesuai jadwal shift! Silahkan ubah status menjadi terlambat atau izin.');
                        return;
                    }
                }
                
                if (pulang && jamPulangShift) {
                    const [pulangHH, pulangMM] = pulang.split(':').map(Number);
                    const [shiftHH, shiftMM] = jamPulangShift.split(':').map(Number);
                    
                    const pulangDate = new Date(2000, 0, 1, pulangHH, pulangMM);
                    const shiftDate = new Date(2000, 0, 1, shiftHH, shiftMM);
                    
                    // Jika absen pulang lebih dari 1 jam sebelum jam shift, tolak
                    if (shiftDate - pulangDate > 60 * 60 * 1000) {
                        alert('Absen pulang tidak sesuai jadwal shift! Silahkan periksa kembali.');
                        return;
                    }
                }
            }
            
            // Inisialisasi jika belum ada
            if (!absensi[bulanInput]) {
                absensi[bulanInput] = {};
            }
            if (!absensi[bulanInput][dateStr]) {
                absensi[bulanInput][dateStr] = [];
            }
            
            // Cek apakah absensi sudah ada
            const existingIndex = absensi[bulanInput][dateStr].findIndex(a => a.karyawanId === parseInt(karyawanId));
            
            if (existingIndex !== -1) {
                // Update absensi yang ada
                absensi[bulanInput][dateStr][existingIndex] = {
                    ...absensi[bulanInput][dateStr][existingIndex],
                    masuk,
                    pulang,
                    status,
                    keterangan
                };
            } else {
                // Tambahkan absensi baru
                absensi[bulanInput][dateStr].push({
                    karyawanId: parseInt(karyawanId),
                    shift: jadwalItem.shift,
                    masuk,
                    pulang,
                    status,
                    keterangan
                });
            }
            
            // Refresh tampilan absensi
            loadAbsensi();
            closeModal('absensiModal');
        }
        
        function updateRekapAbsensi(bulanInput) {
            const tbody = document.querySelector('#rekap-absensi tbody');
            tbody.innerHTML = '';
            
            if (!absensi[bulanInput]) return;
            
            const rekap = {};
            
            // Inisialisasi rekap untuk setiap karyawan aktif
            karyawan.filter(k => k.status === 'active').forEach(k => {
                rekap[k.id] = {
                    nama: k.nama,
                    hadir: 0,
                    terlambat: 0,
                    absen: 0,
                    totalShift: 0
                };
            });
            
            // Hitung rekap dari data absensi
            for (const dateStr in absensi[bulanInput]) {
                absensi[bulanInput][dateStr].forEach(item => {
                    if (!rekap[item.karyawanId]) return;
                    
                    rekap[item.karyawanId].totalShift++;
                    
                    if (item.status === 'hadir') {
                        rekap[item.karyawanId].hadir++;
                    } else if (item.status === 'terlambat') {
                        rekap[item.karyawanId].terlambat++;
                    } else if (item.status === 'alpa') {
                        rekap[item.karyawanId].absen++;
                    }
                    // Status lain seperti cuti, sakit, izin tidak dihitung sebagai absen
                });
            }
            
            // Tampilkan rekap
            for (const karyawanId in rekap) {
                const data = rekap[karyawanId];
                const persentase = data.totalShift > 0 ? Math.round((data.hadir / data.totalShift) * 100) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.nama}</td>
                    <td>${data.hadir}</td>
                    <td>${data.terlambat}</td>
                    <td>${data.absen}</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="flex: 1; background: #eee; height: 20px; border-radius: 10px;">
                                <div style="width: ${persentase}%; background: ${persentase >= 80 ? '#2ecc71' : persentase >= 60 ? '#f39c12' : '#e74c3c'}; height: 100%; border-radius: 10px;"></div>
                            </div>
                            <span>${persentase}%</span>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }
        
        // Penggajian functions
        function hitungGaji() {
            const bulanInput = document.getElementById('bulan-gaji').value;
            if (!bulanInput) {
                alert('Pilih bulan terlebih dahulu!');
                return;
            }
            
            const gajiPokok = parseInt(document.getElementById('gaji-pokok').value) || 0;
            const uangTransport = parseInt(document.getElementById('uang-transport').value) || 0;
            const bonusHarian = parseInt(document.getElementById('bonus-harian').value) || 0;
            const bonusMingguan = parseInt(document.getElementById('bonus-mingguan').value) || 0;
            const bonusBulanan = parseInt(document.getElementById('bonus-bulanan').value) || 0;
            
            const tbody = document.querySelector('#tabel-gaji tbody');
            tbody.innerHTML = '';
            
            // Hitung total shift, absensi, dan potongan per karyawan
            const dataGaji = {};
            
            // Inisialisasi untuk setiap karyawan aktif
            karyawan.filter(k => k.status === 'active').forEach(k => {
                dataGaji[k.id] = {
                    nama: k.nama,
                    totalShift: 0,
                    totalHadir: 0,
                    totalTerlambat: 0,
                    totalAbsen: 0,
                    gajiPokok: 0,
                    transport: 0,
                    bonusHarian: 0,
                    bonusMingguan: 0,
                    bonusBulanan: bonusBulanan,
                    potongan: 0,
                    totalGaji: 0
                };
            });
            
            // Hitung dari jadwal dan absensi
            if (jadwal[bulanInput]) {
                for (const dateStr in jadwal[bulanInput]) {
                    jadwal[bulanInput][dateStr].forEach(item => {
                        if (!dataGaji[item.karyawanId]) return;
                        
                        // Hitung shift
                        if (item.shift !== 'libur') {
                            dataGaji[item.karyawanId].totalShift++;
                            
                            // Gunakan gaji pokok per karyawan jika ada, atau gunakan default
                            const gajiPokokKaryawan = karyawan.find(k => k.id === item.karyawanId)?.gajiPokok || gajiPokok;
                            dataGaji[item.karyawanId].gajiPokok += gajiPokokKaryawan;
                            dataGaji[item.karyawanId].transport += uangTransport;
                        }
                    });
                }
            }
            
            if (absensi[bulanInput]) {
                for (const dateStr in absensi[bulanInput]) {
                    absensi[bulanInput][dateStr].forEach(item => {
                        if (!dataGaji[item.karyawanId]) return;
                        
                        // Hitung kehadiran
                        if (item.status === 'hadir') {
                            dataGaji[item.karyawanId].totalHadir++;
                            dataGaji[item.karyawanId].bonusHarian += bonusHarian;
                        } else if (item.status === 'terlambat') {
                            dataGaji[item.karyawanId].totalTerlambat++;
                            dataGaji[item.karyawanId].bonusHarian += bonusHarian / 2; // Bonus setengah jika terlambat
                        } else if (item.status === 'alpa') {
                            dataGaji[item.karyawanId].totalAbsen++;
                            
                            // Potong gaji untuk hari absen
                            const gajiPokokKaryawan = karyawan.find(k => k.id === item.karyawanId)?.gajiPokok || gajiPokok;
                            dataGaji[item.karyawanId].potongan += gajiPokokKaryawan + uangTransport;
                        }
                    });
                }
            }
            
            // Hitung bonus mingguan (asumsi 4 minggu)
            for (const karyawanId in dataGaji) {
                dataGaji[karyawanId].bonusMingguan = 4 * bonusMingguan;
                
                // Hitung total gaji
                dataGaji[karyawanId].totalGaji = 
                    dataGaji[karyawanId].gajiPokok +
                    dataGaji[karyawanId].transport +
                    dataGaji[karyawanId].bonusHarian +
                    dataGaji[karyawanId].bonusMingguan +
                    dataGaji[karyawanId].bonusBulanan -
                    dataGaji[karyawanId].potongan;
            }
            
            // Tampilkan hasil perhitungan
            for (const karyawanId in dataGaji) {
                const data = dataGaji[karyawanId];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.nama}</td>
                    <td>${data.totalShift}</td>
                    <td class="rupiah">${formatRupiah(data.gajiPokok)}</td>
                    <td class="rupiah">${formatRupiah(data.transport)}</td>
                    <td class="rupiah">${formatRupiah(data.bonusHarian + data.bonusMingguan + data.bonusBulanan)}</td>
                    <td class="rupiah">${formatRupiah(data.potongan)}</td>
                    <td class="rupiah"><strong>${formatRupiah(data.totalGaji)}</strong></td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn" onclick="lihatDetailGaji(${karyawanId}, '${bulanInput}')"><i class="fas fa-eye"></i></button>
                    </td>
                `;
                tbody.appendChild(row);
            }
            
            // Simpan data penggajian
            penggajian[bulanInput] = dataGaji;
        }
        
        function lihatDetailGaji(karyawanId, bulanInput) {
            // Dalam implementasi nyata, ini akan menampilkan modal dengan detail gaji
            alert(`Detail gaji akan ditampilkan untuk karyawan ID ${karyawanId} pada bulan ${bulanInput}`);
        }
        
        // Laporan functions
        function generateLaporan() {
            const jenisLaporan = document.getElementById('jenis-laporan').value;
            const bulanLaporan = document.getElementById('bulan-laporan').value;
            const formatLaporan = document.getElementById('format-laporan').value;
            
            if (!bulanLaporan) {
                alert('Pilih bulan terlebih dahulu!');
                return;
            }
            
            // Dalam implementasi nyata, ini akan menghasilkan laporan sesuai format
            alert(`Generating laporan ${jenisLaporan} untuk bulan ${bulanLaporan} dalam format ${formatLaporan}`);
            
            // Contoh implementasi dengan jsPDF
            if (formatLaporan === 'pdf') {
                // generatePDFLaporan(jenisLaporan, bulanLaporan);
            }
        }
        
        function cetakLaporan() {
            window.print();
        }
        
        // Dashboard functions
        function updateDashboard() {
            // Update total karyawan
            document.getElementById('total-karyawan').textContent = karyawan.filter(k => k.status === 'active').length;
            
            // Update shift hari ini
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const bulanInput = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            
            let shiftToday = 0;
            if (jadwal[bulanInput] && jadwal[bulanInput][todayStr]) {
                shiftToday = jadwal[bulanInput][todayStr].filter(item => item.shift !== 'libur').length;
            }
            document.getElementById('shift-hari-ini').textContent = shiftToday;
            
            // Update belum absen
            let belumAbsen = 0;
            if (jadwal[bulanInput] && jadwal[bulanInput][todayStr]) {
                const totalShift = jadwal[bulanInput][todayStr].filter(item => item.shift !== 'libur').length;
                const sudahAbsen = absensi[bulanInput] && absensi[bulanInput][todayStr] ? 
                    absensi[bulanInput][todayStr].filter(item => item.status === 'hadir' || item.status === 'terlambat').length : 0;
                belumAbsen = totalShift - sudahAbsen;
            }
            document.getElementById('belum-absen').textContent = Math.max(0, belumAbsen);
            
            // Update mini calendar
            updateMiniCalendar();
            
            // Update aktivitas terkini
            updateAktivitasTerkini();
        }
        
        function updateMiniCalendar() {
            const today = new Date();
            const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            const hariDalamBulan = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const tanggalPertama = new Date(today.getFullYear(), today.getMonth(), 1);
            const hariPertama = tanggalPertama.getDay();
            
            const container = document.getElementById('mini-calendar');
            container.innerHTML = '';
            
            const calendar = document.createElement('div');
            calendar.className = 'calendar';
            calendar.style.gridTemplateColumns = 'repeat(7, 1fr)';
            calendar.style.gap = '5px';
            
            // Header hari (singkat)
            const hariSingkat = ['Mg', 'Sn', 'Sl', 'Rb', 'Km', 'Jm', 'Sb'];
            hariSingkat.forEach(hari => {
                const header = document.createElement('div');
                header.style.textAlign = 'center';
                header.style.fontWeight = 'bold';
                header.style.fontSize = '12px';
                header.textContent = hari;
                calendar.appendChild(header);
            });
            
            // Hari kosong di awal
            for (let i = 0; i < hariPertama; i++) {
                const emptyDay = document.createElement('div');
                calendar.appendChild(emptyDay);
            }
            
            // Hari dalam bulan
            for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                const dateStr = currentMonth + '-' + String(tanggal).padStart(2, '0');
                const dayOfWeek = new Date(today.getFullYear(), today.getMonth(), tanggal).getDay();
                
                const day = document.createElement('div');
                day.style.textAlign = 'center';
                day.style.padding = '5px';
                day.style.fontSize = '12px';
                day.style.borderRadius = '50%';
                day.style.aspectRatio = '1';
                day.style.display = 'flex';
                day.style.alignItems = 'center';
                day.style.justifyContent = 'center';
                
                // Highlight hari ini
                if (tanggal === today.getDate()) {
                    day.style.backgroundColor = 'var(--primary-color)';
                    day.style.color = 'white';
                    day.style.fontWeight = 'bold';
                }
                
                // Weekend
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    day.style.color = 'var(--danger-color)';
                }
                
                day.textContent = tanggal;
                calendar.appendChild(day);
            }
            
            container.appendChild(calendar);
        }
        
        function updateAktivitasTerkini() {
            const tbody = document.getElementById('aktivitas-terkini');
            tbody.innerHTML = '';
            
            // Ambil 5 aktivitas terbaru dari absensi
            const aktivitas = [];
            const today = new Date();
            const bulanIni = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            
            if (absensi[bulanIni]) {
                for (const dateStr in absensi[bulanIni]) {
                    absensi[bulanIni][dateStr].forEach(item => {
                        const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                        if (!karyawanData) return;
                        
                        aktivitas.push({
                            tanggal: dateStr,
                            nama: karyawanData.nama,
                            aktivitas: getStatusText(item.status),
                            status: item.status
                        });
                    });
                }
            }
            
            // Urutkan berdasarkan tanggal terbaru
            aktivitas.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
            
            // Tampilkan maksimal 5 aktivitas
            aktivitas.slice(0, 5).forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatTanggal(item.tanggal)}</td>
                    <td>${item.nama}</td>
                    <td>${item.aktivitas}</td>
                    <td><span class="badge ${getStatusBadgeClass(item.status)}">${getStatusText(item.status)}</span></td>
                `;
                tbody.appendChild(row);
            });
            
            if (aktivitas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Tidak ada aktivitas terkini</td></tr>';
            }
        }
        
        // Helper functions
        function formatTanggal(dateStr) {
            if (!dateStr) return '';
            const [tahun, bulan, tanggal] = dateStr.split('-');
            const namaBulan = getNamaBulan(parseInt(bulan) - 1);
            return `${tanggal} ${namaBulan} ${tahun}`;
        }
        
        function getNamaBulan(bulanIndex) {
            const namaBulan = [
                'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
            ];
            return namaBulan[bulanIndex];
        }
        
        function formatRupiah(angka) {
            return 'Rp ' + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }
        
        function getJamShift(shift) {
            switch (shift) {
                case 'pagi': return '07:00 - 15:00';
                case 'sore': return '15:00 - 23:00';
                case 'malam': return '23:00 - 07:00';
                default: return '-';
            }
        }
        
        function getStatusText(status) {
            switch (status) {
                case 'hadir': return 'Hadir';
                case 'terlambat': return 'Terlambat';
                case 'izin': return 'Izin';
                case 'sakit': return 'Sakit';
                case 'cuti': return 'Cuti';
                case 'libur': return 'Libur';
                case 'alpa': return 'Tanpa Keterangan';
                default: return status;
            }
        }
        
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'hadir': return 'badge-pagi';
                case 'terlambat': return 'badge-sore';
                case 'izin': return 'badge-sakit';
                case 'sakit': return 'badge-sakit';
                case 'cuti': return 'badge-cuti';
                case 'libur': return 'badge-libur';
                case 'alpa': return 'badge-malam';
                default: return '';
            }
        }
        
        // Inisialisasi saat halaman dimuat
        window.onload = function() {
            // Set nilai default untuk input bulan ke bulan ini
            const today = new Date();
            const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            
            document.getElementById('bulan-jadwal').value = currentMonth;
            document.getElementById('bulan-gaji').value = currentMonth;
            document.getElementById('bulan-laporan').value = currentMonth;
            document.getElementById('tanggal-absensi').value = today.toISOString().split('T')[0];
            
            // Setup event listeners
            setupTabNavigation();
            setupModalFunctionality();
            
            // Inisialisasi data contoh
            initSampleData();
            
            // Generate jadwal untuk bulan ini
            generateJadwal();
            
            // Hitung gaji untuk bulan ini
            hitungGaji();
        };
    </script>
</body>
</html>
